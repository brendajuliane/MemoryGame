<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/jogo.css">
    <title>Jogo da Memória | Partida</title>

    <script type="text/javascript">

        function getSize() {
            return localStorage.getItem("boardSize");
        }

        function setCardImages(size) {

            let sortedNums = new Map();
            let randomImg;

            for (let i = 0; i < size * size; i++) {
                randomImg = Math.floor((Math.random() * 32) + 1);

                /* If there are less than half of single cards added and this one hasn't been added yet, then
                 * insert it into the map with value '1' */
                if (sortedNums.size < size * size / 2 && !sortedNums.has(randomImg)) {
                    document.getElementById("g" + i).style.backgroundImage = "url(img/cards/c" + randomImg + ".png),"
                        + "url(img/star.svg)";
                    sortedNums.set(randomImg, 1);
                }
                // If there is only one matching card, then insert it into the map with value '2'
                else if (sortedNums.get(randomImg) == 1) {
                    document.getElementById("g" + i).style.backgroundImage = "url(img/cards/c" + randomImg + ".png),"
                        + "url(img/star.svg)";
                    sortedNums.set(randomImg, 2);
                }
                /* If there are already 2 matching cards or half of the cards have been added and this is not
                 * one of them, then randomize a new card to this grid item (i) */
                else
                    i--;

            }

        }

        function loadBoard() {

            size = getSize();

            document.getElementById("boardSize").innerHTML = size + "&times;" + size;

            document.querySelector(".board").style.gridTemplateColumns = "repeat(" + size + ", auto)";

            for (let i = 0; i < size * size; i++) {
                let gridItem = document.createElement('div');
                gridItem.className = "gridItem";
                gridItem.id = "g" + i;
                gridItem.style.height = (68 / size) + "vh";
                document.querySelector(".board").appendChild(gridItem);
            }

            setCardImages(size);
        }

        // unfinished
        function toggleVisibility() {
            size = getSize();

            let backgroundSize;

            if (document.getElementById("tButton").value == 1) {
                backgroundSize = "0%, 40%";
                document.getElementById("tButton").value = 0;
            }
            else {
                backgroundSize = "80%, 0%";
                document.getElementById("tButton").value = 1;
            }

            for (let i = 0; i < size * size; i++)
                document.getElementById("g" + i).style.backgroundSize = backgroundSize;
        }
    </script>

</head>
<body onload="loadBoard()">
    <header>
        <a href="index.html" class="goBackButton"><img src="img/close.png" alt=""></a>
    </header>

    <div>
        <div class="menu">
            <div>
                <img src="img/textoLogo.png" alt="Jogo da memória" id="imgLogo">
            </div>
            <div class="timer">
                <p>00:00</p>
                <p class="itemLabel">Clássico</p>
            </div>
            <div class="menuItem">
                <p class="itemLabel">Tabuleiro:</p>
                <p id="boardSize"></p>
            </div>
            <div class="menuItem">
                <p class="itemLabel">Jogadas:</p>
                <p>22</p>
            </div>
            <div class="divButton">
                <button value=0 onclick="toggleVisibility()" id="tButton">Trapaça</button>
            </div>
        </div>
        <div class="board">
            
        </div>
    </div>
</body>
</html>